// d3.json('resources/commercial.json',function(error,data){
//
//   var crops =[];
//
//   data.forEach(function(d){
//     crops.push(+d["3-2013"]);
//
//   })
//
//
// var svgWidth = 700,
//     svgHeight = 700;
//
// var barHeight = 20;                  //bar height.
//
// var x = d3.scale.linear()           //scale the data to pixel space.
//     .domain([0, d3.max(crops)])
//     .range([0, svgWidth]);
//
// var axis = d3.svg.axis()
//              .ticks(10)
//              .scale(x)
//              .orient("bottom");
//
//
// //color variation for different data.
// var color = d3.scale.linear()
//             .domain([0,d3.max(crops)])
//             .range(["red","blue"]);
//
// //create a canvas to hold chart.
//
// var canvas = d3.selectAll("body")
//                 .append("svg")
//                 .attr("width",svgWidth)
//                 .attr("height",svgHeight)
//                 .append("g")
//                 .attr("transform","translate(50,20)");
//
// canvas.append("g")
//       .attr("transform", "translate(0,150)")
//       .call(axis);
//
// //bars that represent the data
//
// var bars = canvas.selectAll("rect")
//                   .data(data)
//                   .enter().append("rect")
//
//                           .attr("width",function(d){ return x(d["3-2013"]);})
//                           .attr("height",barHeight)
//                           .attr("fill", function(d){return color(d["3-2013"]);})
//                           .attr("y",function(d,i){return i*(barHeight+5);})
//
//
//   canvas.selectAll("g")
//         .data(data)
//         .update().append("text")
//       .attr("y", barHeight / 2)
//       .attr("dy", ".35em")
//       .attr("z-index",100)
//       .text(function(d) { return d.Particulars; });
//
// });
var margin = {top: 20, right: 30, bottom: 30, left: 40},
width = 960 - margin.left - margin.right,
height = 500 - margin.top - margin.bottom;

createChart('resources/commercial.json');


function createChart(resource){

  d3.json(resource,function(error,data){
    var crops =[];

    data.forEach(function(d){
      if(d["3-2013"]=="NA" || d["3-2013"]==null)
      {
        d["3-2013"] =0;
      }
      else {
        d["3-2013"] =+d["3-2013"];
      }
      crops.push(+d["3-2013"]);


    })


    var width = 960,
    barHeight = 20;

    var x = d3.scale.linear()
    .domain([0, d3.max(crops)])
    .range([0, width*0.7]);


    var chart = d3.select(".chart")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var xAxis = d3.svg.axis()
    .ticks(20)
    .scale(x)
    .orient("bottom");

    // When DOM elements < Data elements then -> enter()
    // // When DOM elements > Data elements then -> exit()
    // // When DOM elements = Data elements then -> update()
    //
    //
     var bar = chart.selectAll("g")
    .data(data)
    .enter().append("g")
    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });


    chart.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + barHeight * crops.length  + ")")
    .call(xAxis);

    bar.append("rect")
    .attr("width", function(d){return x(d["3-2013"])})
    .attr("height", barHeight - 1);

    //The dy attribute indicates a shift along the y-axis on the position of an element or its content.
   // What exactly is shifted depends on the element for which this attribute is set.
  //In this case it is the label.
   
    bar.append("text")
    .text(function(d){return (d.Particulars.replace("Agricultural Production Commercial Crops","") + "("+d["3-2013"]+")");})
    .attr("x",function(d){return x(d["3-2013"]);})
    .attr("y", barHeight/2)
    .attr("dy",".35em")
    .attr("dx","11em");

    //.attr("dx", function(d){return x(d["3-2013"])});
    // bar.append("text")
    //     .attr("x", function(d) { return x(d["3-2013"]); })
    //     .attr("y", barHeight / 2)
    //     .attr("dy", ".35em")
    //     .attr("dx","4em")
    //     .attr("text-align","right")
    //     .text(function(d) { return d.Particulars; });
  });
}
